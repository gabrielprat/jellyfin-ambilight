services:
  jellyfin-ambilight:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: jellyfin-ambilight
    hostname: jellyfin-ambilight
    restart: unless-stopped

    # Load environment variables from .env and pass them into the container
    env_file:
      - .env

    environment:
      - PYTHONUNBUFFERED=1

    volumes:
      # Source code mount (for development)
      - ./:/app/src:ro

      # Data persistence
      - ${DATA_PATH:-./data}:/app/data

      # Media access (READ-ONLY)
      - ${MOVIES_PATH:-./test-media/movies}:/media/movies:ro
      - ${TV_PATH:-./test-media/tv}:/media/tv:ro

    # Minimal resource usage
    # Removed deploy resource limits to avoid cgroup warnings on non-supporting kernels

    # Use custom homelab network with static IP
    networks:
      homelab-network:

    # DNS configuration for homelab - multiple fallbacks for reliability
    dns:
      - 192.168.1.191  # Primary homelab DNS
      - 1.1.1.1        # Cloudflare DNS (fallback)
      - 8.8.8.8        # Google DNS (fallback)

    # Additional DNS options for reliability
    dns_opt:
      - timeout:2
      - attempts:3

networks:
  homelab-network:
    external: true
