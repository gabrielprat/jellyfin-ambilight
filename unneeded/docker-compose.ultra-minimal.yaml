services:
  jellyfin-ambilight:
    build:
      context: .
      dockerfile: Dockerfile.ultra-minimal
    container_name: jellyfin-ambilight-minimal
    restart: unless-stopped
    network_mode: host  # Simple, no DNS issues

    environment:
      - JELLYFIN_API_KEY=${JELLYFIN_API_KEY}
      - JELLYFIN_BASE_URL=${JELLYFIN_BASE_URL}
      - WLED_HOST=${WLED_HOST:-wled-ambilight-lgc1.lan}
      - WLED_UDP_PORT=${WLED_UDP_PORT:-21324}
      - AMBILIGHT_TOP_LED_COUNT=${AMBILIGHT_TOP_LED_COUNT:-89}
      - AMBILIGHT_BOTTOM_LED_COUNT=${AMBILIGHT_BOTTOM_LED_COUNT:-89}
      - AMBILIGHT_LEFT_LED_COUNT=${AMBILIGHT_LEFT_LED_COUNT:-49}
      - AMBILIGHT_RIGHT_LED_COUNT=${AMBILIGHT_RIGHT_LED_COUNT:-49}
      - AMBILIGHT_INPUT_POSITION=${AMBILIGHT_INPUT_POSITION:-46}
      - FRAMES_PER_SECOND=${FRAMES_PER_SECOND:-10}
      - LIBRARY_SCAN_INTERVAL=${LIBRARY_SCAN_INTERVAL:-3600}
      - PLAYBACK_MONITOR_INTERVAL=${PLAYBACK_MONITOR_INTERVAL:-1.0}

    volumes:
      - ./:/app/src:ro  # Source code
      - ${DATA_PATH:-./data}:/app/data  # Data
      - ${MOVIES_PATH:-/path/to/movies}:/media/movies:ro
      - ${TV_PATH:-/path/to/tv}:/media/tv:ro

    # Minimal resource requirements
    deploy:
      resources:
        limits:
          memory: 256M  # Was 2GB!
          cpus: '0.3'
        reservations:
          memory: 64M
          cpus: '0.1'
